<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ä¸ƒä¸¦ã¹</title>
<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
<style>
#hand { margin: 20px; }
.card { display: inline-block; width: 60px; height: 90px; border: 1px solid #000; text-align:center; line-height:90px; margin: 3px; cursor:pointer; }
#table { margin: 20px; }
.suit { margin: 10px 0; }
</style>
</head>
<body>
<h1>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ä¸ƒä¸¦ã¹</h1>
<div id="table" style="display:flex; justify-content:center; margin-top:50px;">
    <div class="suit" id="hearts"></div>
    <div class="suit" id="spades"></div>
    <div class="suit" id="diamonds"></div>
    <div class="suit" id="clubs"></div>
</div>

<h3>ã‚ãªãŸã®æ‰‹æœ­</h3>
<div id="hand" style="position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%); display:flex;"></div>
<script>
const socket = io();

const username = "{{ username }}";
const room = "{{ room_id }}"; // ç°¡æ˜“ç‰ˆ: å›ºå®šãƒ«ãƒ¼ãƒ 

console.log("usename : " + username);
console.log("room_id : " + room);
socket.emit("join_game", {username, room});

/*
socket.on("update_hands", hands => {
    const myHand = hands[username];

    // ğŸ”¹ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«è‡ªåˆ†ã®æ‰‹æœ­ã‚’è¡¨ç¤º
    console.log("ğŸ“¥ å—ä¿¡ã—ãŸæ‰‹æœ­:", myHand);
    const handDiv = document.getElementById("hand");
    handDiv.innerHTML = "";
    myHand.forEach(card => {
        const c = document.createElement("div");
        c.className = "card";
        c.textContent = card;
        c.onclick = () => {
            socket.emit("play_card", {username, room, card});
        }
        handDiv.appendChild(c);
    });
});
*/

socket.on("update_hands", hands => {
    console.log("hands:", hands);

    // è‡ªåˆ†ã®æ‰‹æœ­ã ã‘è¡¨ç¤º
    const myHand = hands[username];
    if (!myHand) return;
    const suitsOrder = ["H","S","D","K"];
    const sortedHand = suitsOrder.flatMap(suit => 
        myHand
            .filter(c => c.startsWith(suit))
            .sort((a,b) => parseInt(a.slice(1)) - parseInt(b.slice(1)))
    );

    const handDiv = document.getElementById("hand");
    handDiv.innerHTML = "";

    myHand.forEach(card => {
        const c = document.createElement("div");
        c.className = "card";

        const img = document.createElement("img");
        img.src = `/static/cards/${card}.png`;
        img.alt = card;
        img.style.width = "60px";
        img.style.height = "90px";
        img.style.cursor = "pointer";

        img.onclick = () => {
            socket.emit("play_card", {username, room, card});
        };

        c.appendChild(img);
        handDiv.appendChild(c);
    });

    const table = {
        H: document.getElementById("hearts"),
        S: document.getElementById("spades"),
        D: document.getElementById("diamonds"),
        K: document.getElementById("clubs")
    };
    for (const s of suitsOrder) {
        table[s].innerHTML = "";
        const sevenCard = myHand.find(c => c === `${s}7`);
        if (sevenCard) {
            const img7 = document.createElement("img");
            img7.src = `/static/cards/${sevenCard}.png`;
            img7.style.width = "60px";
            img7.style.height = "90px";
            table[s].appendChild(img7);
        }
    }
    
});


socket.on("card_played", data => {
    // å ´ã®æ›´æ–°
    for (const suit in data.table) {
        const suitDiv = document.getElementById(suit.toLowerCase());
        suitDiv.textContent = data.table[suit].join(" ");
    }
});
</script>
</body>
</html>
